<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title data-react-helmet="true">cerico | Javascript Router with State</title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font-size:112.5%;line-height:1.65em;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:normal;word-wrap:break-word;}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:2.25rem;line-height:2.475rem;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.62671rem;line-height:2.475rem;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.38316rem;line-height:1.65rem;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.65rem;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.85028rem;line-height:1.65rem;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.78405rem;line-height:1.65rem;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}ul{margin-left:1.65rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.65rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;font-size:0.85rem;line-height:1.42;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;padding:1.65rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;font-size:1rem;line-height:1.65rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}blockquote{margin-left:1.65rem;margin-right:1.65rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.65rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.65rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.65rem;margin-bottom:calc(1.65rem / 2);margin-top:calc(1.65rem / 2);}li > ul{margin-left:1.65rem;margin-bottom:calc(1.65rem / 2);margin-top:calc(1.65rem / 2);}code{font-size:0.85rem;line-height:1.65rem;}kbd{font-size:0.85rem;line-height:1.65rem;}samp{font-size:0.85rem;line-height:1.65rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:tnum;padding-left:1.1rem;padding-right:1.1rem;padding-top:0.825rem;padding-bottom:calc(0.825rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:Consolas,"Roboto Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;}pre code{background:none;line-height:1.42;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:"";}</style><link href="//fonts.googleapis.com/css?family=Roboto:400,400i,700" rel="stylesheet" type="text/css"/><style>@import url(https://fonts.googleapis.com/css?family=Raleway);.hljs{display:block;overflow-x:auto;padding:.5em;background:#000;color:#f8f8f8}.hljs-comment,.hljs-quote{color:#aeaeae;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#e28964}.hljs-string{color:#65b042}.hljs-subst{color:#daefa3}.hljs-link,.hljs-regexp{color:#e9c062}.hljs-name,.hljs-section,.hljs-tag,.hljs-title{color:#89bdff}.hljs-class .hljs-title,.hljs-doctag{text-decoration:underline}.hljs-bullet,.hljs-number,.hljs-symbol{color:#3387cc}.hljs-params,.hljs-template-variable,.hljs-variable{color:#3e87e3}.hljs-attribute{color:#cda869}.hljs-meta{color:#8996a8}.hljs-formula{background-color:#0e2231;color:#f8f8f8;font-style:italic}.hljs-addition{background-color:#253b22;color:#f8f8f8}.hljs-deletion{background-color:#420e09;color:#f8f8f8}.hljs-selector-class{color:#9b703f}.hljs-selector-id{color:#8b98ab}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}*{font-family:Fira Sans,sans-serif}body{color:#5f5c5c;font-family:PT Serif,serif;line-height:1.2em;margin:1em auto 4em;padding:0 18px;position:relative}pre{background:#000;color:#f8f8f8}pre *{font-family:Consolas,Roboto Mono,Liberation Mono,Menlo,Courier,monospace}h1,h2{text-rendering:optimizeLegibility}.inverse-topper,.topper{font-family:PT Sans,sans-serif;font-size:64px;font-weight:300;letter-spacing:-2px;line-height:1em;margin:.5em 0}.inverse-topper{color:#fff}.markdown{margin-top:23.8px;margin-top:1.7rem}body{font-family:Fira Sans,sans-serif;font-weight:300;margin:0;background:#fff;color:#3a3a3a;margin-bottom:126px;margin-bottom:9rem}header[role=banner]{background:#6495ed;padding:22px 0 0;margin-top:12px;height:112px;height:8rem;text-align:center;color:#fff}header[role=banner] h1{margin:0}header[role=banner] h3{font-size:37.8px;font-size:2.7rem}header{font-family:Raleway,sans-serif;font-weight:100;text-rendering:optimizeLegibility;line-height:1;margin-top:0}a,header{color:#6495ed}a{outline:none;transition:color .3s ease;text-decoration:none}h1{font-weight:300;font-size:70px;font-size:5rem;margin:0;font-family:Raleway,sans-serif;font-weight:100;color:#6495ed;text-rendering:optimizeLegibility}h1,h3{line-height:1}h3{font-size:37.8px;font-size:2.7rem;color:#5f5c5c;font-weight:"Fira Sans",sans-serif;font-weight:300}html{font-size:14px}article,main{display:block}.content{max-width:900px}.content,.page-content{margin:14px auto;margin:1rem auto}.page-content{max-width:720px}.post{position:relative;width:80%;margin:42px auto;margin:3rem auto;padding-bottom:42px;padding-bottom:3rem;border-bottom:1px solid #ccc;word-break:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.post-meta{display:inline-block;margin:0 0 5px;font-size:28px;font-size:2rem;color:#9eabb3}.post-meta a{color:#9eabb3;text-decoration:none}.post-title{margin:0;color:#6495ed}h2{font-size:56px;font-size:4rem}section{max-width:960px;margin:auto}.post-excerpt p{margin:22.4px 0 0;margin:1.6rem 0 0;line-height:22.4px;line-height:1.6rem}dl,ol,p,ul{margin:22.4px 0;margin:1.6rem 0;font-size:17.92px;font-size:1.28rem;line-height:1.6}ol,ul{margin-left:22.4px!important;margin-left:1.6rem!important}header h1,header h3{color:#fff}</style></head><body><div id="react-mount"><div data-reactroot="" data-reactid="1" data-react-checksum="303586003"><div class="headroom-wrapper" data-reactid="2"><div style="position:relative;top:0;left:0;right:0;z-index:1;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);" class="headroom headroom--unfixed" data-reactid="3"><header role="banner" data-reactid="4"><a class="inverse-topper" href="/" data-reactid="5">cerico</a></header></div></div><div style="margin-left:2%;" data-reactid="6"><p style="margin-bottom:0.33rem;" data-reactid="7"><a href="/about/" data-reactid="8"><img src="https://s3.eu-west-2.amazonaws.com/io1937/ghpages/linkedin.jpg" style="float:left;margin-top:0;margin-bottom:0;margin-right:0.4125rem;width:3.3rem;height:3.3rem;border-radius:50%;border:1px gray solid;" data-reactid="9"/></a><span data-reactid="10"><!-- react-text: 11 -->garethrobertlee<!-- /react-text --><a href="/about/" data-reactid="12"></a></span></p><div data-reactid="13"><div data-reactid="14"><span data-reactid="15"><a href="/" data-reactid="16">Posts | </a><a href="/about/" data-reactid="17">About | </a></span><a href="mailto:garethrobertlee@gmail.com?Subject=Hello" target="blank_" data-reactid="18">Contact</a></div></div></div><div class="markdown page-content" data-reactid="19"><!-- react-empty: 20 --><div data-reactid="21"><div style="font-size:2rem;color:#9EABB3;margin-bottom:1px;text-align:center;" data-reactid="22"><!-- react-text: 23 -->12 Sep 2017<!-- /react-text --><!-- react-text: 24 --> in <!-- /react-text --><span style="display:inline;" data-reactid="25"><span style="margin-right:8px;line-height:1.5;" data-reactid="26"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#es6" data-reactid="27">ES6</a><span data-reactid="28">,</span></span><span style="margin-right:8px;line-height:1.5;" data-reactid="29"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#javascript" data-reactid="30">Javascript</a><span data-reactid="31"></span></span></span></div></div><h1 style="font-size:4rem;margin-bottom:1rem;margin-top:2rem;" data-reactid="32">Javascript Router with State</h1><div data-reactid="33"><p>As we saw at the end of the previous piece, we can update content on the page with a click, but once we navigate to another page and back again our updated content is lost.</p>
<p><img src="https://dl.dropboxusercontent.com/s/6ktat8t4q9vzyah/A85D07AC-B814-4351-A712-F6D0AD9FE907-574-0000322A62D2EF7C.gif?dl=0" alt=""></p>
<p>In this piece we’ll look at maintaining state across route changes.</p>
<p><a href="https://github.com/cerico/how-to-js-router/tree/0.15.1">https://github.com/cerico/how-to-js-router/tree/0.15.1</a></p>
<h3>Pre-requisites / Previous posts</h3>
<p><a href="../2017-08-26---javascript-router/">Part One</a></p>
<p><a href="../2017-09-02---js-router-part-two-refresh/">Part Two</a></p>
<p><a href="../2017-09-11---introducing-web-components/">Part Three</a></p>
<p>Or we can just jump straight in here…</p>
<p><a href="https://github.com/cerico/how-to-js-router/tree/0.15.1">https://github.com/cerico/how-to-js-router/tree/0.15.1</a></p>
<h3>Spoilers</h3>
<ol>
<li>Introduce a page counter for one component</li>
<li>Creating a store</li>
<li>Creating an action</li>
<li>Updating the store</li>
<li>Updating the component</li>
<li>Next Steps</li>
</ol>
<h3>1. Introduce a page counter for one component</h3>
<p>A clicked yes/no isn’t super conducive to seeing different states, so lets change it to a classic click counter.</p>
<pre><code>➜  how-to-js-router git:(master) cat -n src/js/components/kendal.js
     <span class="hljs-number">1</span>	export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KendalComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HTMLElement</span> </span>{
     <span class="hljs-number">2</span>
     <span class="hljs-number">3</span>	    handleClick(){
     <span class="hljs-number">4</span>	        console.log(<span class="hljs-string">"clicked"</span>)
     <span class="hljs-number">5</span>	        <span class="hljs-keyword">this</span>.state.counter += <span class="hljs-number">1</span>
     <span class="hljs-number">6</span>	        <span class="hljs-keyword">this</span>.render()
     <span class="hljs-number">7</span>	    }
     <span class="hljs-number">8</span>
     <span class="hljs-number">9</span>	    connectedCallback() {
    <span class="hljs-number">10</span>	        <span class="hljs-keyword">this</span>.state = {}
    <span class="hljs-number">11</span>	        <span class="hljs-keyword">this</span>.state.counter = <span class="hljs-number">0</span>
    <span class="hljs-number">12</span>	        <span class="hljs-keyword">this</span>.render();
    <span class="hljs-number">13</span>	        <span class="hljs-keyword">this</span>.addEventListener(<span class="hljs-symbol">'clic</span>k',<span class="hljs-keyword">this</span>.handleClick)
    <span class="hljs-number">14</span>	    }
    <span class="hljs-number">15</span>
    <span class="hljs-number">16</span>	    render() {
    <span class="hljs-number">17</span>	        <span class="hljs-keyword">this</span>.innerHTML = (
    <span class="hljs-number">18</span>	            `&lt;div style=<span class="hljs-string">"height:100px;background:orange"</span>&gt;
    <span class="hljs-number">19</span>	               &lt;div&gt;<span class="hljs-type">Page</span> <span class="hljs-type">Counter</span> = ${<span class="hljs-keyword">this</span>.state.counter}&lt;/div&gt;
    <span class="hljs-number">20</span>	            &lt;/div&gt;`
    <span class="hljs-number">21</span>	        )
    <span class="hljs-number">22</span>	    }
    <span class="hljs-number">23</span>	}
    <span class="hljs-number">24</span>
    <span class="hljs-number">25</span>	customElements.define(<span class="hljs-symbol">'kendal</span>-component', <span class="hljs-type">KendalComponent</span>)
</code></pre>
<p>Same thing happens before, we move to a different route and return, and our counter is reset back to zero.</p>
<p><a href="https://github.com/cerico/how-to-js-router/tree/0.16.0">https://github.com/cerico/how-to-js-router/tree/0.16.0</a></p>
<h3>2. Creating a store</h3>
<p>First off we create a store, which will hold the state</p>
<pre><code>➜  how-<span class="hljs-keyword">to</span>-js-router git:(master) cat src/js/store.js
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> store =  <span class="hljs-comment">{
    counter: 0
}</span>;
</code></pre>
<p>And we can import this into our component and set our local state to match.</p>
<pre><code>➜  how-to-js-router git:(master) cat -n src/js/components/kendal.js
     <span class="hljs-number">1</span>	<span class="hljs-keyword">import</span> { store  } from <span class="hljs-string">"../store"</span>;
     <span class="hljs-number">2</span>
     <span class="hljs-number">3</span>	export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KendalComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HTMLElement</span> </span>{
     <span class="hljs-number">4</span>
   ...
    <span class="hljs-number">11</span>	    connectedCallback() {
    <span class="hljs-number">12</span>	        <span class="hljs-keyword">this</span>.state = {}
    <span class="hljs-number">13</span>	        <span class="hljs-keyword">this</span>.state.counter = store.counter
    <span class="hljs-number">14</span>	        <span class="hljs-keyword">this</span>.render();
   ...
</code></pre>
<p><a href="https://github.com/cerico/how-to-js-router/tree/0.17.0">https://github.com/cerico/how-to-js-router/tree/0.17.0</a></p>
<h3>3. Creating an action</h3>
<p>Now we need to update the store, rather than just the local state.</p>
<pre><code>➜  how-to-js-router git:(<span class="hljs-number">16.3</span>) cat -n src/js/components/kendal.js
     <span class="hljs-number">1</span>	<span class="hljs-keyword">import</span> { store  } from <span class="hljs-string">"../store"</span>;
     <span class="hljs-number">2</span>
     <span class="hljs-number">3</span>	export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KendalComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HTMLElement</span> </span>{
     <span class="hljs-number">4</span>
     <span class="hljs-number">5</span>	    handleClick(){
     <span class="hljs-number">6</span>	        console.log(<span class="hljs-string">"clicked"</span>)
     <span class="hljs-number">7</span>	        document.dispatchEvent(<span class="hljs-keyword">new</span> <span class="hljs-type">CustomEvent</span>(<span class="hljs-symbol">'actio</span>n', { detail: <span class="hljs-symbol">'increaseCoun</span>t' }));
     <span class="hljs-number">8</span>	        <span class="hljs-keyword">this</span>.render()
   ...
</code></pre>
<p>So, on click we create a custom event, which we can listen for elsewhere in the app, as the event is attached to the document, not the component. Lets move over to the store.</p>
<pre><code>➜  how-to-js-router git:(master) cat src/js/store.js
<span class="hljs-keyword">export</span> const store =  {
    counter: <span class="hljs-number">0</span>
};

<span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">'action'</span>, <span class="hljs-function"><span class="hljs-params">(e)</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(e))
</code></pre>
<p>The custom event we send in the components handleClick function, is now picked up here in the store. We can just log it for now</p>
<p><img src="https://dl.dropboxusercontent.com/s/y372ltmx2pbrb8b/Screen%20Shot%20on%202017-09-14%20at%2013%3A54%3A33.png?dl=0" alt=""></p>
<p>The two importan things to note here, are the type (‘action’), and detail (‘increaseCount’).</p>
<p><a href="https://github.com/cerico/how-to-js-router/tree/0.18.0">https://github.com/cerico/how-to-js-router/tree/0.18.0</a></p>
<h3>4. Updating the store</h3>
<pre><code>➜  how-to-js-router git:(<span class="hljs-number">20.0</span>) ✗ cat -n src/js/store.js
     <span class="hljs-number">1</span>	export const store =  {
     <span class="hljs-number">2</span>	  counter: <span class="hljs-number">0</span>
     <span class="hljs-number">3</span>	};
     <span class="hljs-number">4</span>
     <span class="hljs-number">5</span>	document.addEventListener('action', (e) =&gt; {
     <span class="hljs-number">6</span>	  let result = counter(store, e.detail);
     <span class="hljs-number">7</span>	  console.<span class="hljs-keyword">log</span>(result)
     <span class="hljs-number">8</span>	})
     <span class="hljs-number">9</span>
    <span class="hljs-number">10</span>	function counter(<span class="hljs-keyword">state</span>, action) {
    <span class="hljs-number">11</span>	  console.<span class="hljs-keyword">log</span>(<span class="hljs-keyword">state</span>,action)
    <span class="hljs-number">12</span>		switch (action) {
    <span class="hljs-number">13</span>	    case 'increaseCount':
    <span class="hljs-number">14</span>	      const newState = Object.assign(<span class="hljs-keyword">state</span>, {
    <span class="hljs-number">15</span>					counter: <span class="hljs-keyword">state</span>.counter + <span class="hljs-number">1</span>
    <span class="hljs-number">16</span>				});
    <span class="hljs-number">17</span>				return newState
    <span class="hljs-number">18</span>			<span class="hljs-keyword">default</span>:
    <span class="hljs-number">19</span>				return <span class="hljs-keyword">state</span>;
    <span class="hljs-number">20</span>	  }
    <span class="hljs-number">21</span>	}
</code></pre>
<p>We’ve created a new counter function here, which we pass the existing store, and the action we receive from whichever custom event is created, in our case we only have one so far, ‘increaseCount’.</p>
<p>When this function runs it creats a newState object (never modifying existing state), and returns that, which we can see logged on line 7</p>
<p><img src="https://dl.dropboxusercontent.com/s/3i425eq67qqq823/increase.png?dl=0" alt=""></p>
<p><a href="https://github.com/cerico/how-to-js-router/tree/0.19.0">https://github.com/cerico/how-to-js-router/tree/0.19.0</a></p>
<p>Now we need to return that to the component.</p>
<h3>5. Updating the component</h3>
<p>We can fire off another custom event, updating the document to say there has been a state change</p>
<pre><code>➜  how-to-js-router git:(<span class="hljs-number">20.0</span>) cat -n src/js/store.js
     <span class="hljs-number">1</span>	<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> store =  {
     <span class="hljs-number">2</span>	  counter: <span class="hljs-number">0</span>
     <span class="hljs-number">3</span>	};
     <span class="hljs-number">4</span>
     <span class="hljs-number">5</span>	<span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">'action'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
     <span class="hljs-number">6</span>	  <span class="hljs-keyword">let</span> result = counter(store, e.detail);
     <span class="hljs-number">7</span>	  <span class="hljs-built_in">document</span>.dispatchEvent(<span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">'stateChange'</span>));
     <span class="hljs-number">8</span>	})
</code></pre>
<p>And we can pick this up wherever we like, in our case the Kendal component.</p>
<pre><code>➜  how-to-js-router git:(<span class="hljs-number">20.0</span>) ✗ cat -n src/js/components/kendal.js
     <span class="hljs-number">1</span>	<span class="hljs-keyword">import</span> { store  } from <span class="hljs-string">"../store"</span>;
     <span class="hljs-number">2</span>
     <span class="hljs-number">3</span>	export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KendalComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HTMLElement</span> </span>{
   ...
    <span class="hljs-number">11</span>	    connectedCallback() {
    <span class="hljs-number">12</span>	        <span class="hljs-keyword">this</span>.render();
    <span class="hljs-number">13</span>	        <span class="hljs-keyword">this</span>.addEventListener(<span class="hljs-symbol">'clic</span>k',<span class="hljs-keyword">this</span>.handleClick)
    <span class="hljs-number">14</span>	        document.addEventListener(<span class="hljs-symbol">'stat</span>e', () =&gt; <span class="hljs-keyword">this</span>.render());
    <span class="hljs-number">15</span>	    }
</code></pre>
<p>We can now remove local state entirely, as we have access to the store</p>
<pre><code>➜  how-to-js-router git:(master) cat -n src/js/components/kendal.js
     <span class="hljs-number">1</span>	<span class="hljs-keyword">import</span> { store  } from <span class="hljs-string">"../store"</span>;
     <span class="hljs-number">2</span>
     <span class="hljs-number">3</span>	export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KendalComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HTMLElement</span> </span>{
   ...
    <span class="hljs-number">17</span>	    render() {
    <span class="hljs-number">18</span>	        <span class="hljs-keyword">this</span>.innerHTML = (
    <span class="hljs-number">19</span>	            `&lt;div style=<span class="hljs-string">"height:100px;background:orange"</span>&gt;
    <span class="hljs-number">20</span>	               &lt;div&gt;<span class="hljs-type">Page</span> <span class="hljs-type">Counter</span> = ${store.counter}&lt;/div&gt;
    <span class="hljs-number">21</span>	            &lt;/div&gt;`
    <span class="hljs-number">22</span>	        )
    <span class="hljs-number">23</span>	    }
    <span class="hljs-number">24</span>	}
</code></pre>
<p>The store is now the single point of truth for the counter. Which should mean, when we change pages and return…the counter no longer resets.</p>
<p><img src="https://dl.dropboxusercontent.com/s/son7xslavj6sbuw/87F79E72-B232-4D87-9BFC-B05638CBB82C-574-00003FF119F42451.gif?dl=0" alt=""></p>
<ol start="6">
<li>Next Steps</li>
</ol>
<p>Next we can expand the store to encompass different counters on different pages, and showing each pages counter in the nav bar. We will also link up the vanilla state with the vanilla router, and show a log of visited pages and keep track of the active route.</p>
</div><div data-reactid="34"><span style="display:inline;" data-reactid="35"><span style="margin-right:8px;line-height:1.5;" data-reactid="36"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#es6" data-reactid="37">ES6</a><span data-reactid="38">,</span></span><span style="margin-right:8px;line-height:1.5;" data-reactid="39"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#javascript" data-reactid="40">Javascript</a><span data-reactid="41"></span></span></span><hr style="margin-top:1.07rem;" data-reactid="42"/><p style="margin-bottom:0.33rem;" data-reactid="43"><a href="/about/" data-reactid="44"><img src="https://s3.eu-west-2.amazonaws.com/io1937/ghpages/linkedin.jpg" style="float:left;margin-top:0;margin-bottom:0;margin-right:0.4125rem;width:3.3rem;height:3.3rem;border-radius:50%;border:1px gray solid;" data-reactid="45"/></a><span data-reactid="46"><!-- react-text: 47 -->garethrobertlee<!-- /react-text --><a href="/about/" data-reactid="48"></a></span></p><div data-reactid="49"><div data-reactid="50"><span data-reactid="51"><a href="/" data-reactid="52">Posts | </a><a href="/about/" data-reactid="53">About | </a></span><a href="mailto:garethrobertlee@gmail.com?Subject=Hello" target="blank_" data-reactid="54">Contact</a></div></div></div></div></div></div><script src="/bundle.js?t=1505398113093"></script></body></html>