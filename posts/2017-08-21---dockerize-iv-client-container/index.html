<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title data-react-helmet="true">cerico | Javascript Container</title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font-size:112.5%;line-height:1.65em;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:normal;word-wrap:break-word;}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:2.25rem;line-height:2.475rem;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.62671rem;line-height:2.475rem;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.38316rem;line-height:1.65rem;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.65rem;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.85028rem;line-height:1.65rem;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.78405rem;line-height:1.65rem;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}ul{margin-left:1.65rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.65rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;font-size:0.85rem;line-height:1.42;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;padding:1.65rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;font-size:1rem;line-height:1.65rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}blockquote{margin-left:1.65rem;margin-right:1.65rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.65rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.65rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.65rem;margin-bottom:calc(1.65rem / 2);margin-top:calc(1.65rem / 2);}li > ul{margin-left:1.65rem;margin-bottom:calc(1.65rem / 2);margin-top:calc(1.65rem / 2);}code{font-size:0.85rem;line-height:1.65rem;}kbd{font-size:0.85rem;line-height:1.65rem;}samp{font-size:0.85rem;line-height:1.65rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:tnum;padding-left:1.1rem;padding-right:1.1rem;padding-top:0.825rem;padding-bottom:calc(0.825rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:Consolas,"Roboto Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;}pre code{background:none;line-height:1.42;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:"";}</style><link href="//fonts.googleapis.com/css?family=Roboto:400,400i,700" rel="stylesheet" type="text/css"/><style>@import url(https://fonts.googleapis.com/css?family=Raleway);.hljs{display:block;overflow-x:auto;padding:.5em;background:#000;color:#f8f8f8}.hljs-comment,.hljs-quote{color:#aeaeae;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#e28964}.hljs-string{color:#65b042}.hljs-subst{color:#daefa3}.hljs-link,.hljs-regexp{color:#e9c062}.hljs-name,.hljs-section,.hljs-tag,.hljs-title{color:#89bdff}.hljs-class .hljs-title,.hljs-doctag{text-decoration:underline}.hljs-bullet,.hljs-number,.hljs-symbol{color:#3387cc}.hljs-params,.hljs-template-variable,.hljs-variable{color:#3e87e3}.hljs-attribute{color:#cda869}.hljs-meta{color:#8996a8}.hljs-formula{background-color:#0e2231;color:#f8f8f8;font-style:italic}.hljs-addition{background-color:#253b22;color:#f8f8f8}.hljs-deletion{background-color:#420e09;color:#f8f8f8}.hljs-selector-class{color:#9b703f}.hljs-selector-id{color:#8b98ab}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}*{font-family:Fira Sans,sans-serif}body{color:#5f5c5c;font-family:PT Serif,serif;line-height:1.2em;margin:1em auto 4em;padding:0 18px;position:relative}pre{background:#000;color:#f8f8f8}pre *{font-family:Consolas,Roboto Mono,Liberation Mono,Menlo,Courier,monospace}h1,h2{text-rendering:optimizeLegibility}.inverse-topper,.topper{font-family:PT Sans,sans-serif;font-size:64px;font-weight:300;letter-spacing:-2px;line-height:1em;margin:.5em 0}.inverse-topper{color:#fff}.markdown{margin-top:23.8px;margin-top:1.7rem}body{font-family:Fira Sans,sans-serif;font-weight:300;margin:0;background:#fff;color:#3a3a3a;margin-bottom:126px;margin-bottom:9rem}header[role=banner]{background:#6495ed;padding:22px 0 0;margin-top:12px;height:112px;height:8rem;text-align:center;color:#fff}header[role=banner] h1{margin:0}header[role=banner] h3{font-size:37.8px;font-size:2.7rem}header{font-family:Raleway,sans-serif;font-weight:100;text-rendering:optimizeLegibility;line-height:1;margin-top:0}a,header{color:#6495ed}a{outline:none;transition:color .3s ease;text-decoration:none}h1{font-weight:300;font-size:70px;font-size:5rem;margin:0;font-family:Raleway,sans-serif;font-weight:100;color:#6495ed;text-rendering:optimizeLegibility}h1,h3{line-height:1}h3{font-size:37.8px;font-size:2.7rem;color:#5f5c5c;font-weight:"Fira Sans",sans-serif;font-weight:300}html{font-size:14px}article,main{display:block}.content{max-width:900px}.content,.page-content{margin:14px auto;margin:1rem auto}.page-content{max-width:720px}.post{position:relative;width:80%;margin:42px auto;margin:3rem auto;padding-bottom:42px;padding-bottom:3rem;border-bottom:1px solid #ccc;word-break:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.post-meta{display:inline-block;margin:0 0 5px;font-size:28px;font-size:2rem;color:#9eabb3}.post-meta a{color:#9eabb3;text-decoration:none}.post-title{margin:0;color:#6495ed}h2{font-size:56px;font-size:4rem}section{max-width:960px;margin:auto}.post-excerpt p{margin:22.4px 0 0;margin:1.6rem 0 0;line-height:22.4px;line-height:1.6rem}dl,ol,p,ul{margin:22.4px 0;margin:1.6rem 0;font-size:17.92px;font-size:1.28rem;line-height:1.6}ol,ul{margin-left:22.4px!important;margin-left:1.6rem!important}header h1,header h3{color:#fff}</style></head><body><div id="react-mount"><div data-reactroot="" data-reactid="1" data-react-checksum="-2061131493"><div class="headroom-wrapper" data-reactid="2"><div style="position:relative;top:0;left:0;right:0;z-index:1;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);" class="headroom headroom--unfixed" data-reactid="3"><header role="banner" data-reactid="4"><a class="inverse-topper" href="/" data-reactid="5">cerico</a></header></div></div><div style="margin-left:2%;" data-reactid="6"><p style="margin-bottom:0.33rem;" data-reactid="7"><a href="/about/" data-reactid="8"><img src="https://s3.eu-west-2.amazonaws.com/io1937/ghpages/linkedin.jpg" style="float:left;margin-top:0;margin-bottom:0;margin-right:0.4125rem;width:3.3rem;height:3.3rem;border-radius:50%;border:1px gray solid;" data-reactid="9"/></a><span data-reactid="10"><!-- react-text: 11 -->garethrobertlee<!-- /react-text --><a href="/about/" data-reactid="12"></a></span></p><div data-reactid="13"><div data-reactid="14"><span data-reactid="15"><a href="/" data-reactid="16">Posts | </a><a href="/about/" data-reactid="17">About | </a></span><a href="mailto:garethrobertlee@gmail.com?Subject=Hello" target="blank_" data-reactid="18">Contact</a></div></div></div><div class="markdown page-content" data-reactid="19"><!-- react-empty: 20 --><div data-reactid="21"><div style="font-size:2rem;color:#9EABB3;margin-bottom:1px;text-align:center;" data-reactid="22"><!-- react-text: 23 -->21 Aug 2017<!-- /react-text --><!-- react-text: 24 --> in <!-- /react-text --><span style="display:inline;" data-reactid="25"><span style="margin-right:8px;line-height:1.5;" data-reactid="26"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#docker" data-reactid="27">Docker</a><span data-reactid="28">,</span></span><span style="margin-right:8px;line-height:1.5;" data-reactid="29"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#webpack" data-reactid="30">Webpack</a><span data-reactid="31">,</span></span><span style="margin-right:8px;line-height:1.5;" data-reactid="32"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#node" data-reactid="33">Node</a><span data-reactid="34">,</span></span><span style="margin-right:8px;line-height:1.5;" data-reactid="35"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#javascript" data-reactid="36">Javascript</a><span data-reactid="37"></span></span></span></div></div><h1 style="font-size:4rem;margin-bottom:1rem;margin-top:2rem;" data-reactid="38">Javascript Container</h1><div data-reactid="39"><p>We want our client and server containers to be as simple as possible. Our client container is very straightforward. It is only going to do two things, firstly display the message “I am from js”, and secondly make a get request to the Clojure API and display the message it receives - which should be “and I’m from Clojure”.</p>
<h3>TLDR / Repo</h3>
<p>Repository is here <a href="https://github.com/institute1937/marsden">https://github.com/institute1937/marsden</a></p>
<hr>
<h3>Pages</h3>
<ul>
<li><a href="../2017-08-17---dockerize-i-intro/">Part One - Intro</a></li>
<li><a href="../2017-08-18---dockerize-ii-dockerfiles/">Part Two - Dockerfiles</a></li>
<li><a href="../2017-08-21---dockerize-iii-nginx/">Part Three - Nginx</a></li>
<li>Part Four - Client App</li>
<li><a href="../2017-08-21---dockerize-v-clojure-container/">Part Five - Server App</a></li>
<li><a href="../2017-08-21---dockerize-vi-provision-exoscale/">Part Six - Provisioning</a></li>
<li><a href="../2017-08-23---dockerize-vii-connect-existing-machine/">Part Seven - Connect Existing</a></li>
<li>Part Eight - Ansible - soon</li>
</ul>
<p>Lets start with reminding ourselves of our docker setup for the client.</p>
<pre><code>➜  marsden git:(master) cat client/Dockerfile<span class="hljs-selector-class">.dev</span>
</code></pre>
<pre><code><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">8.2</span>.<span class="hljs-number">1</span>-alpine

<span class="hljs-keyword">ADD</span><span class="bash"> . /src
</span><span class="hljs-keyword">WORKDIR</span><span class="bash"> /src
</span><span class="hljs-keyword">RUN</span><span class="bash"> /usr/<span class="hljs-built_in">local</span>/bin/npm install
</span></code></pre>
<pre><code>➜  <span class="hljs-selector-tag">marsden</span> <span class="hljs-selector-tag">git</span><span class="hljs-selector-pseudo">:(master)</span> <span class="hljs-selector-tag">cat</span> <span class="hljs-selector-tag">docker-compose</span><span class="hljs-selector-class">.yml</span>
</code></pre>
<pre><code><span class="hljs-attribute">version</span>: <span class="hljs-string">"2"</span>
<span class="hljs-attribute">services</span>:

    <span class="hljs-attribute">web</span>:
        <span class="hljs-attribute">build</span>:
          <span class="hljs-attribute">context</span>: ./client
          <span class="hljs-attribute">dockerfile</span>: Dockerfile.dev
        <span class="hljs-attribute">volumes</span>:
          - <span class="hljs-string">"./client:/build"</span>
          - /build/node_modules
        <span class="hljs-attribute">working_dir</span>: /build
        <span class="hljs-attribute">command</span>: <span class="hljs-string">'npm run dev'</span>
        <span class="hljs-attribute">ports</span>:
          - <span class="hljs-number">6800</span>:<span class="hljs-number">5000</span>
</code></pre>
<pre><code>➜  marsden gi<span class="hljs-variable">t:</span>(master) <span class="hljs-keyword">cat</span> Makefile
</code></pre>
<pre><code>start:
	docker-compose up

bundle:
	cd<span class="hljs-built_in"> client </span>&amp;&amp; npm <span class="hljs-builtin-name">run</span> build

build:
	docker-compose up --build
</code></pre>
<p>We’ll run ‘make start’ when we want to run as normal, and ‘make build’ if we’ve made changes like installing new packages. When we run make build, npm install runs inside the client container, installing new packages. If we just run ‘make start’ then ‘npm run dev’ is run inside the client, as per the docker-compose.yml. Let’s have a look at that.</p>
<hr>
<h3>npm run dev</h3>
<pre><code>➜  marsden <span class="hljs-string">git:</span>(master) cat client/<span class="hljs-keyword">package</span>.json
</code></pre>
<pre><code>{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"yesmate"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">""</span>,
  <span class="hljs-attr">"main"</span>: <span class="hljs-string">"js/index.js"</span>,
  <span class="hljs-attr">"scripts"</span>: {
    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,
    <span class="hljs-attr">"dev"</span>: <span class="hljs-string">"webpack-dev-server --host 0.0.0.0 --env.dev"</span>
</code></pre>
<p>‘npm run dev’ runs the webpack-dev-server, its important to note the host specified as 0.0.0.0. Its not reachable via docker without specifying this address.</p>
<hr>
<h3>Webpack</h3>
<pre><code>➜  marsden git:(master) cat client/webpack<span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.js</span>
</code></pre>
<pre><code><span class="hljs-string">module.exports</span> <span class="hljs-string">=</span> <span class="hljs-string">options</span> <span class="hljs-string">=&gt;</span> <span class="hljs-string">{</span>
  <span class="hljs-string">return</span> <span class="hljs-string">{</span>
<span class="hljs-attr">    entry:</span> <span class="hljs-string">'./src/js/index.js'</span><span class="hljs-string">,</span>
<span class="hljs-attr">    output:</span> <span class="hljs-string">{</span>
<span class="hljs-attr">      filename:</span> <span class="hljs-string">'bundle.js'</span><span class="hljs-string">,</span>
    <span class="hljs-string">},</span>
<span class="hljs-attr">    devtool:</span> <span class="hljs-string">'source-map'</span><span class="hljs-string">,</span>
<span class="hljs-attr">    devServer:</span> <span class="hljs-string">{</span>
<span class="hljs-attr">       port:</span> <span class="hljs-number">5000</span><span class="hljs-string">,</span>
<span class="hljs-attr">       disableHostCheck:</span> <span class="hljs-literal">true</span>
    <span class="hljs-string">},</span>
  <span class="hljs-string">}</span>
<span class="hljs-string">}</span>
</code></pre>
<p>Webpack is out of the scope of this series, what we’re mainly interested with here is the fact that its going to run the dev build on port 5000, which is where nginx will route client traffic to. Other than that webpacks job is to bundle our src js files into one bundle and then serve it on that port.</p>
<hr>
<h3>Javascript</h3>
<p>All our JS in one index file with one function. Its job is to output two messages, one of its own and one it gets from the clojure API.</p>
<pre><code>➜  marsden gi<span class="hljs-variable">t:</span>(master) <span class="hljs-keyword">cat</span> client/src/js/<span class="hljs-built_in">index</span>.js
</code></pre>
<pre><code>document.body.onload = addElement;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addElement</span> </span>() {
  let currentDiv = document.getElementById(<span class="hljs-string">"front"</span>);
  <span class="hljs-keyword">var</span> <span class="hljs-keyword">new</span><span class="hljs-type">Div</span> = document.createElement(<span class="hljs-string">"div"</span>);
  <span class="hljs-keyword">var</span> <span class="hljs-keyword">new</span><span class="hljs-type">Content</span> = document.createTextNode(<span class="hljs-string">"I am from js"</span>);
  <span class="hljs-keyword">new</span><span class="hljs-type">Div</span>.appendChild(<span class="hljs-keyword">new</span><span class="hljs-type">Content</span>); <span class="hljs-comment">//add the text node to the newly created div.</span>
  currentDiv.appendChild(<span class="hljs-keyword">new</span><span class="hljs-type">Div</span>)

  const host = window.location.host

  const API = <span class="hljs-string">'http://'</span> + host + <span class="hljs-string">'/clojure'</span>;
  fetch(API).then(<span class="hljs-function"><span class="hljs-keyword">function</span></span>(res){
    res.json().then(body =&gt; {
       <span class="hljs-keyword">var</span> <span class="hljs-keyword">new</span><span class="hljs-type">Div</span> = document.createElement(<span class="hljs-string">"div"</span>);
       <span class="hljs-keyword">var</span> <span class="hljs-keyword">new</span><span class="hljs-type">Content</span> = document.createTextNode(body.message)
       <span class="hljs-keyword">new</span><span class="hljs-type">Div</span>.appendChild(<span class="hljs-keyword">new</span><span class="hljs-type">Content</span>); <span class="hljs-comment">//add the text node to the newly created div.</span>
       currentDiv.appendChild(<span class="hljs-keyword">new</span><span class="hljs-type">Div</span>)
    });
  })
}
</code></pre>
<p>The addElement function runs when body is loaded. It creates one div, makes an API call and then creates a second div. The important thing to note here is that the API URL is our current url and the clojure directory. No reference to any other ports, we’re decoupled.</p>
<hr>
<h3>Production</h3>
<p>We’re not ready to deploy yet, but let’s look at how our production setup will work.</p>
<pre><code>➜  marsden gi<span class="hljs-variable">t:</span>(master) <span class="hljs-keyword">cat</span> Makefile
</code></pre>
<pre><code>start:
	docker-compose up

bundle:
	cd<span class="hljs-built_in"> client </span>&amp;&amp; npm <span class="hljs-builtin-name">run</span> build
</code></pre>
<p>‘make bundle’ will cd into the client folder and run npm build</p>
<pre><code>➜  marsden <span class="hljs-string">git:</span>(master) cat client/<span class="hljs-keyword">package</span>.json
</code></pre>
<pre><code>{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"yesmate"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">""</span>,
  <span class="hljs-attr">"main"</span>: <span class="hljs-string">"js/index.js"</span>,
  <span class="hljs-attr">"scripts"</span>: {
    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,
    <span class="hljs-attr">"dev"</span>: <span class="hljs-string">"webpack-dev-server --host 0.0.0.0 --env.dev"</span>,
    <span class="hljs-attr">"build"</span>: <span class="hljs-string">"webpack --config webpack.prod.config.js  --env.prod"</span>,
</code></pre>
<p>Which builds us a production bundle…</p>
<pre><code>➜  marsden git:(master) cat client/webpack<span class="hljs-selector-class">.prod</span><span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.js</span>
</code></pre>
<pre><code><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-params">options</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">entry</span>: <span class="hljs-string">'./src/js/index.js'</span>,
    <span class="hljs-attr">output</span>: {
      <span class="hljs-attr">path</span>: path.join(__dirname, <span class="hljs-string">'./dist'</span>),
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'bundle.js'</span>,
    }
  }
}
</code></pre>
<p>Pretty similar to our dev webpack, but it doesn’t serve anything, it simply outputs our prod ready bundle to the dist folder. We can then use express to serve it, instead of webpack…</p>
<pre><code>➜  marsden git:(master) cat <span class="hljs-keyword">client</span>/<span class="hljs-keyword">server</span>.js
</code></pre>
<pre><code><span class="hljs-keyword">var</span> path = <span class="hljs-keyword">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">var</span> express = <span class="hljs-keyword">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> server = express();

server.<span class="hljs-keyword">use</span>(express.<span class="hljs-keyword">static</span>(<span class="hljs-string">'.'</span>));
server.<span class="hljs-keyword">use</span>(express.<span class="hljs-keyword">static</span>(path.join(__dirname, <span class="hljs-string">'./dist'</span>)));
server.listen(process.env.PORT || <span class="hljs-number">5000</span>);
</code></pre>
<p>Express is going to serve our production bundle on 5000, just the same as webpack did with the dev bundle. And our production Dockerfile is what runs this file.</p>
<pre><code>➜  marsden gi<span class="hljs-variable">t:</span>(master) <span class="hljs-keyword">cat</span> client/Dockerfile
</code></pre>
<pre><code><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">8.2</span>.<span class="hljs-number">1</span>-alpine

<span class="hljs-keyword">COPY</span><span class="bash"> . /src
</span><span class="hljs-keyword">WORKDIR</span><span class="bash"> /src
</span><span class="hljs-keyword">RUN</span><span class="bash"> /usr/<span class="hljs-built_in">local</span>/bin/npm install
</span><span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">"node"</span>, <span class="hljs-string">"server.js"</span>]
</span></code></pre>
<p>Note the extra ‘CMD’ command not present in the dev dockerfile.</p>
<hr>
<h2>Next</h2>
<p><a href="../2017-08-21---dockerize-v-clojure-container/">Part Five - Server App</a></p>
</div><div data-reactid="40"><span style="display:inline;" data-reactid="41"><span style="margin-right:8px;line-height:1.5;" data-reactid="42"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#docker" data-reactid="43">Docker</a><span data-reactid="44">,</span></span><span style="margin-right:8px;line-height:1.5;" data-reactid="45"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#webpack" data-reactid="46">Webpack</a><span data-reactid="47">,</span></span><span style="margin-right:8px;line-height:1.5;" data-reactid="48"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#node" data-reactid="49">Node</a><span data-reactid="50">,</span></span><span style="margin-right:8px;line-height:1.5;" data-reactid="51"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#javascript" data-reactid="52">Javascript</a><span data-reactid="53"></span></span></span><hr style="margin-top:1.07rem;" data-reactid="54"/><p style="margin-bottom:0.33rem;" data-reactid="55"><a href="/about/" data-reactid="56"><img src="https://s3.eu-west-2.amazonaws.com/io1937/ghpages/linkedin.jpg" style="float:left;margin-top:0;margin-bottom:0;margin-right:0.4125rem;width:3.3rem;height:3.3rem;border-radius:50%;border:1px gray solid;" data-reactid="57"/></a><span data-reactid="58"><!-- react-text: 59 -->garethrobertlee<!-- /react-text --><a href="/about/" data-reactid="60"></a></span></p><div data-reactid="61"><div data-reactid="62"><span data-reactid="63"><a href="/" data-reactid="64">Posts | </a><a href="/about/" data-reactid="65">About | </a></span><a href="mailto:garethrobertlee@gmail.com?Subject=Hello" target="blank_" data-reactid="66">Contact</a></div></div></div></div></div></div><script src="/bundle.js?t=1506944334642"></script></body></html>