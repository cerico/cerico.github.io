<!DOCTYPE html>
 <html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title data-react-helmet="true">cerico | Introducing Web Components</title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font-size:112.5%;line-height:1.65em;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:normal;word-wrap:break-word;}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:2.25rem;line-height:2.475rem;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.62671rem;line-height:2.475rem;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.38316rem;line-height:1.65rem;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.65rem;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.85028rem;line-height:1.65rem;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;color:hsla(0,0%,0%,0.8);font-family:Roboto,sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.78405rem;line-height:1.65rem;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}ul{margin-left:1.65rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.65rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;font-size:0.85rem;line-height:1.42;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;padding:1.65rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;font-size:1rem;line-height:1.65rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}blockquote{margin-left:1.65rem;margin-right:1.65rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.65rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.65rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.65rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.65rem;margin-bottom:calc(1.65rem / 2);margin-top:calc(1.65rem / 2);}li > ul{margin-left:1.65rem;margin-bottom:calc(1.65rem / 2);margin-top:calc(1.65rem / 2);}code{font-size:0.85rem;line-height:1.65rem;}kbd{font-size:0.85rem;line-height:1.65rem;}samp{font-size:0.85rem;line-height:1.65rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:tnum;padding-left:1.1rem;padding-right:1.1rem;padding-top:0.825rem;padding-bottom:calc(0.825rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:Consolas,"Roboto Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;}pre code{background:none;line-height:1.42;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:"";}</style><link href="//fonts.googleapis.com/css?family=Roboto:400,400i,700" rel="stylesheet" type="text/css"/><style>@import url(https://fonts.googleapis.com/css?family=Raleway);.hljs{display:block;overflow-x:auto;padding:.5em;background:#000;color:#f8f8f8}.hljs-comment,.hljs-quote{color:#aeaeae;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#e28964}.hljs-string{color:#65b042}.hljs-subst{color:#daefa3}.hljs-link,.hljs-regexp{color:#e9c062}.hljs-name,.hljs-section,.hljs-tag,.hljs-title{color:#89bdff}.hljs-class .hljs-title,.hljs-doctag{text-decoration:underline}.hljs-bullet,.hljs-number,.hljs-symbol{color:#3387cc}.hljs-params,.hljs-template-variable,.hljs-variable{color:#3e87e3}.hljs-attribute{color:#cda869}.hljs-meta{color:#8996a8}.hljs-formula{background-color:#0e2231;color:#f8f8f8;font-style:italic}.hljs-addition{background-color:#253b22;color:#f8f8f8}.hljs-deletion{background-color:#420e09;color:#f8f8f8}.hljs-selector-class{color:#9b703f}.hljs-selector-id{color:#8b98ab}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}*{font-family:Fira Sans,sans-serif}body{color:#5f5c5c;font-family:PT Serif,serif;line-height:1.2em;margin:1em auto 4em;padding:0 18px;position:relative}pre{background:#000;color:#f8f8f8}pre *{font-family:Consolas,Roboto Mono,Liberation Mono,Menlo,Courier,monospace}h1,h2{text-rendering:optimizeLegibility}.inverse-topper,.topper{font-family:PT Sans,sans-serif;font-size:64px;font-weight:300;letter-spacing:-2px;line-height:1em;margin:.5em 0}.inverse-topper{color:#fff}.markdown{margin-top:23.8px;margin-top:1.7rem}body{font-family:Fira Sans,sans-serif;font-weight:300;margin:0;background:#fff;color:#3a3a3a;margin-bottom:126px;margin-bottom:9rem}header[role=banner]{background:#6495ed;padding:22px 0 0;margin-top:12px;height:112px;height:8rem;text-align:center;color:#fff}header[role=banner] h1{margin:0}header[role=banner] h3{font-size:37.8px;font-size:2.7rem}header{font-family:Raleway,sans-serif;font-weight:100;text-rendering:optimizeLegibility;line-height:1;margin-top:0}a,header{color:#6495ed}a{outline:none;transition:color .3s ease;text-decoration:none}h1{font-weight:300;font-size:70px;font-size:5rem;margin:0;font-family:Raleway,sans-serif;font-weight:100;color:#6495ed;text-rendering:optimizeLegibility}h1,h3{line-height:1}h3{font-size:37.8px;font-size:2.7rem;color:#5f5c5c;font-weight:"Fira Sans",sans-serif;font-weight:300}html{font-size:14px}article,main{display:block}.content{max-width:900px}.content,.page-content{margin:14px auto;margin:1rem auto}.page-content{max-width:720px}.post{position:relative;width:80%;margin:42px auto;margin:3rem auto;padding-bottom:42px;padding-bottom:3rem;border-bottom:1px solid #ccc;word-break:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}.post-meta{display:inline-block;margin:0 0 5px;font-size:28px;font-size:2rem;color:#9eabb3}.post-meta a{color:#9eabb3;text-decoration:none}.post-title{margin:0;color:#6495ed}h2{font-size:56px;font-size:4rem}section{max-width:960px;margin:auto}.post-excerpt p{margin:22.4px 0 0;margin:1.6rem 0 0;line-height:22.4px;line-height:1.6rem}dl,ol,p,ul{margin:22.4px 0;margin:1.6rem 0;font-size:17.92px;font-size:1.28rem;line-height:1.6}ol,ul{margin-left:22.4px!important;margin-left:1.6rem!important}header h1,header h3{color:#fff}</style></head><body><div id="react-mount"><div data-reactroot="" data-reactid="1" data-react-checksum="949015716"><div class="headroom-wrapper" data-reactid="2"><div style="position:relative;top:0;left:0;right:0;z-index:1;-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);" class="headroom headroom--unfixed" data-reactid="3"><header role="banner" data-reactid="4"><a class="inverse-topper" href="/" data-reactid="5">cerico</a></header></div></div><div style="margin-left:2%;" data-reactid="6"><p style="margin-bottom:0.33rem;" data-reactid="7"><a href="/about/" data-reactid="8"><img src="https://s3.eu-west-2.amazonaws.com/io1937/ghpages/linkedin.jpg" style="float:left;margin-top:0;margin-bottom:0;margin-right:0.4125rem;width:3.3rem;height:3.3rem;border-radius:50%;border:1px gray solid;" data-reactid="9"/></a><span data-reactid="10"><!-- react-text: 11 -->garethrobertlee<!-- /react-text --><a href="/about/" data-reactid="12"></a></span></p><div data-reactid="13"><div data-reactid="14"><span data-reactid="15"><a href="/" data-reactid="16">Posts | </a><a href="/about/" data-reactid="17">About | </a></span><a href="mailto:garethrobertlee@gmail.com?Subject=Hello" target="blank_" data-reactid="18">Contact</a></div></div></div><div class="markdown page-content" data-reactid="19"><!-- react-empty: 20 --><div data-reactid="21"><div style="font-size:2rem;color:#9EABB3;margin-bottom:1px;text-align:center;" data-reactid="22"><!-- react-text: 23 -->7 Sep 2017<!-- /react-text --><!-- react-text: 24 --> in <!-- /react-text --><span style="display:inline;" data-reactid="25"><span style="margin-right:8px;line-height:1.5;" data-reactid="26"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#es6" data-reactid="27">ES6</a><span data-reactid="28">,</span></span><span style="margin-right:8px;line-height:1.5;" data-reactid="29"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#javascript" data-reactid="30">Javascript</a><span data-reactid="31"></span></span></span></div></div><h1 style="font-size:4rem;margin-bottom:1rem;margin-top:2rem;" data-reactid="32">Introducing Web Components</h1><div data-reactid="33"><p>This is intended as a part 3 of ‘How to build a JS router’ but can also work as a standalone guide. We can pick the repo up here, at stage 11, as a starting point.</p>
<p>Repo at stage 11: <a href="https://github.com/cerico/how-to-js-router/releases/tag/0.11.1">https://github.com/cerico/how-to-js-router/releases/tag/0.11.1</a></p>
<p>The problem we want to solve is that our html is living in html files, outside of our bundle and we’re using Fetch to retrieve them. Our aim is to replace Fetch and get them inside the js bundle, and to do this we’re going to use web components.</p>
<h3>Pre-requisites</h3>
<p><a href="../2017-08-26---javascript-router/">Part One</a></p>
<p><a href="../2017-09-02---js-router-part-two-refresh/">Part Two</a></p>
<p>Not really pre-requisites if we clone the repo above, but a guide to how we got to this point.</p>
<h3>Spoilers</h3>
<ol>
<li>Install webcomponents</li>
<li>Update dev webpack</li>
<li>Create Component files</li>
<li>Update routes object to use components</li>
<li>Register the Components</li>
<li>Inject Component on load/click</li>
<li>Import original views</li>
<li>Production</li>
</ol>
<h3>1. Install webcomponents</h3>
<pre><code>➜  how-<span class="hljs-keyword">to</span>-js-router gi<span class="hljs-variable">t:</span>(master) <span class="hljs-keyword">cat</span> package.json
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"how-to-js-router"</span>,
...
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"express"</span>: <span class="hljs-string">"^4.15.4"</span>,
    <span class="hljs-string">"path"</span>: <span class="hljs-string">"^0.12.7"</span>,
    <span class="hljs-string">"@webcomponents/webcomponentsjs"</span>: <span class="hljs-string">"git://github.com/webcomponents/webcomponentsjs.git#v1.0.0"</span>
  }
}
</code></pre>
<p>Our package.json should look like this.</p>
<h3>2.  Update dev webpack</h3>
<pre><code>➜  how-to-js-router git:(twelve-components) ✗ cat -n webpack/webpack.config.js
     <span class="hljs-number">1</span>	<span class="hljs-keyword">let</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);
     <span class="hljs-number">2</span>
     <span class="hljs-number">3</span>	<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-params">options</span> =&gt;</span> {
     <span class="hljs-number">4</span>	  <span class="hljs-keyword">return</span> {
   ...
     <span class="hljs-number">9</span>	    devtool: <span class="hljs-string">'source-map'</span>,
    <span class="hljs-number">10</span>	    plugins: [<span class="hljs-keyword">new</span> webpack.IgnorePlugin(<span class="hljs-regexp">/vertx/</span>)],
    ...
</code></pre>
<p>It will still actually work for our simple setup if we don’t add this IgnorePlugin line, but it will throw the following warning at us if we don’t</p>
<pre><code><span class="hljs-literal">WARNING</span> <span class="hljs-keyword">in</span> ./node_modules/@webcomponents/webcomponentsjs/webcomponents-lite.js
Module <span class="hljs-keyword">not</span> found: <span class="hljs-literal">Error</span>: Can<span class="hljs-symbol">'t</span> resolve <span class="hljs-symbol">'vertx</span>' <span class="hljs-keyword">in</span> /Users/garethrobertl...
</code></pre>
<p>You can read more about why here</p>
<p><a href="https://github.com/webcomponents/webcomponentsjs/issues/794">https://github.com/webcomponents/webcomponentsjs/issues/794</a></p>
<h3>3. Create Component files</h3>
<pre><code>export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MaltonComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HTMLElement</span> </span>{
    constructor() {
        <span class="hljs-keyword">super</span>();
    }

    connectedCallback() {
        <span class="hljs-keyword">this</span>.innerHTML = <span class="hljs-keyword">this</span>.render();
    }

    render() {
        <span class="hljs-keyword">return</span> (&lt;div&gt;hello from malton&lt;/div&gt;);
    }
}
</code></pre>
<p>Each component we create will have a constructor, for when its initiated, a render function for what gets outputted - and a connectedCallback function which runs the render function.</p>
<p>In short, the constructor is called when the element is created, and connectedCallback is called when attached to the DOM, at which point we can attach the content we want.</p>
<h3>4. Update routes object to use components</h3>
<pre><code><span class="hljs-keyword">import</span> { MaltonComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/malton'</span>
<span class="hljs-keyword">import</span> { GlossopComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/glossop'</span>
<span class="hljs-keyword">import</span> { KendalComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/kendal'</span>
<span class="hljs-keyword">import</span> { HerefordComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/hereford'</span>
<span class="hljs-keyword">import</span> { DefaultComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/default'</span>



<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> routes = {
    <span class="hljs-attr">glossop</span>: GlossopComponent,
    <span class="hljs-attr">kendal</span>:  KendalComponent,
    <span class="hljs-attr">hereford</span>:  HerefordComponent,
    <span class="hljs-attr">malton</span>:   MaltonComponent,
    <span class="hljs-string">''</span> : DefaultComponent
}
</code></pre>
<p>A simple swapping out of pages for components.</p>
<h3>5. Register the Components</h3>
<p>Now we need to register the components, they’ll have a tagName (eg <my-custom-element></my-custom-element>, and the connectedCallback in the component itself, this is where we’ll attach our component, as we saw before. We’ll register our components on index initialization, prior to initializing the router.</p>
<pre><code><span class="hljs-keyword">import</span> { Delph } <span class="hljs-keyword">from</span> <span class="hljs-string">'./delph'</span>
<span class="hljs-keyword">import</span> { routes } <span class="hljs-keyword">from</span> <span class="hljs-string">'./routes'</span>
<span class="hljs-keyword">import</span> { ComponentRegistry } <span class="hljs-keyword">from</span> <span class="hljs-string">"./utils/component-registry"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Index</span> </span>{

    <span class="hljs-keyword">constructor</span>(){
      <span class="hljs-keyword">const</span> page = <span class="hljs-built_in">window</span>.location.pathname.substr(<span class="hljs-number">1</span>) || <span class="hljs-string">''</span>
      <span class="hljs-keyword">let</span> main = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'main'</span>)
      <span class="hljs-keyword">this</span>.registerComponents(routes)
      <span class="hljs-keyword">this</span>.delph = <span class="hljs-keyword">new</span> Delph(routes, main, page)
 ...

    registerComponents(routes){
      <span class="hljs-keyword">return</span> ComponentRegistry.register(routes);
    }
...
</code></pre>
<p>We need to register our new components before we can use them, so the order here is important. We register our components before we instantiate our router. Lets look at the ComponentRegistry.</p>
<pre><code>➜  how-to-js-router git:(thirteen-registering) ✗ cat src/js/utils/component-registry.js
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ComponentRegistry</span> </span>{
    <span class="hljs-keyword">static</span> register(components) {
        <span class="hljs-built_in">Object</span>.entries(components).map(<span class="hljs-function"><span class="hljs-params">obj</span> =&gt;</span> {
            <span class="hljs-keyword">let</span> tag = obj[<span class="hljs-number">0</span>] || <span class="hljs-string">'index'</span>
            <span class="hljs-keyword">let</span> component = {
                <span class="hljs-attr">tagName</span> : <span class="hljs-string">`core-<span class="hljs-subst">${tag}</span>`</span>,
                <span class="hljs-attr">callBack</span>: obj[<span class="hljs-number">1</span>]
            }
            <span class="hljs-built_in">window</span>.customElements.define(component.tagName, component.callBack);
          })
    }
}
</code></pre>
<p>Quite a bit happening here so let run through each piece.</p>
<ul>
<li>The ComponentRegistry has one function ‘register’, which will take all the components passed to it</li>
<li>tag - We’ll create a tagName from the name of the component. And as the root (’/’) is nameless, we’ll give any nameless route a name of index.</li>
<li>callback - This is the component we want attached (the second parameter in each route object.</li>
</ul>
<p>More on this here <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/customElements">https://developer.mozilla.org/en-US/docs/Web/API/Window/customElements</a></p>
<p>Lets go back to our router, comment out the route.load line from the previous article, and just console.log what we have</p>
<pre><code> how-<span class="hljs-keyword">to</span>-js-router git:(thirteen-registering) cat -n src/js/delph.js
     <span class="hljs-number">1</span>	<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Delph</span> {</span>
     <span class="hljs-number">2</span>
   ...
    <span class="hljs-number">24</span>	    <span class="hljs-keyword">let</span> route =  <span class="hljs-keyword">this</span>.routes[page];
    <span class="hljs-number">25</span>	    <span class="hljs-keyword">if</span> (route) {
    <span class="hljs-number">26</span>	      <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">new</span> route)
    <span class="hljs-number">27</span>	      // route.load().<span class="hljs-keyword">then</span>(r =&gt; route.show(<span class="hljs-keyword">this</span>.el));
   ...
</code></pre>
<p><img src="https://s3.amazonaws.com/how-to-js-router/element.png" alt="view" title="view"></p>
<h3>6. Inject Component on load/click</h3>
<p>So this is great, we have a custom element but now we need to append it to the DOM. We’ll make an inject function in our router, and pass the appropriate element to it.</p>
<pre><code>➜  how-to-js-router git:(fourteen-inject) cat -n src/js/delph.js
     <span class="hljs-number">1</span>	<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Delph</span> </span>{
     <span class="hljs-number">2</span>
     <span class="hljs-number">3</span>	  <span class="hljs-keyword">constructor</span>(routes,el,page){
     <span class="hljs-number">4</span>	    <span class="hljs-keyword">this</span>.routes = routes;
     <span class="hljs-number">5</span>	    <span class="hljs-keyword">this</span>.el = el;
   ...
    <span class="hljs-number">20</span>	  inject(component) {
    <span class="hljs-number">21</span>	    <span class="hljs-keyword">const</span> routerOutlet = <span class="hljs-keyword">this</span>.el
    <span class="hljs-number">22</span>	    <span class="hljs-keyword">while</span> (routerOutlet.firstChild) {
    <span class="hljs-number">23</span>	      routerOutlet.removeChild(routerOutlet.firstChild);
    <span class="hljs-number">24</span>	    }
    <span class="hljs-number">25</span>	    routerOutlet.appendChild(<span class="hljs-keyword">new</span> component);
    <span class="hljs-number">26</span>	  }
    <span class="hljs-number">27</span>
    <span class="hljs-number">28</span>	  load(page, backButtonUsed){
    <span class="hljs-number">29</span>	    <span class="hljs-keyword">if</span> (!backButtonUsed){
    <span class="hljs-number">30</span>	      history.pushState({ page}, <span class="hljs-literal">null</span>, <span class="hljs-string">`/<span class="hljs-subst">${page}</span>`</span>);
    <span class="hljs-number">31</span>	    }
    <span class="hljs-number">32</span>	    <span class="hljs-keyword">let</span> route =  <span class="hljs-keyword">this</span>.routes[page];
    <span class="hljs-number">33</span>	    <span class="hljs-keyword">if</span> (route) {
    <span class="hljs-number">34</span>	      <span class="hljs-keyword">this</span>.inject(route)
    <span class="hljs-number">35</span>	    } <span class="hljs-keyword">else</span> {
    <span class="hljs-number">36</span>	      <span class="hljs-keyword">this</span>.el.innerHTML = <span class="hljs-string">"no page found"</span>
    <span class="hljs-number">37</span>	    }
    <span class="hljs-number">38</span>	  }
    <span class="hljs-number">39</span>	}
</code></pre>
<p>The inject function receives the custom element, and appends it to the router element, which is the element we passed the router on instantiation.</p>
<p>Repo at stage 12: <a href="https://github.com/cerico/how-to-js-router/releases/tag/0.12">https://github.com/cerico/how-to-js-router/releases/tag/0.12</a></p>
<h3>7. Import original views</h3>
<p>If we remember back to our original static html files that we were retrieving with fetch, we can now turn these into template strings and import then into our components. So we can go from this</p>
<pre><code>➜  how-to-js-router git:(fifteen-views) cat views/glossop.html
<span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:white;background: cornflowerblue;display:block;list-style:none"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>glossop<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>hadfield<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>tintwistle<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>to this…</p>
<pre><code>➜  how-to-js-router git:(fifteen-views) ✗ cat src/js/views/glossop.js
export const html =

`<span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"color:white;background: cornflowerblue;display:block;list-style:none"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>glossop<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>hadfield<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>tintwistle<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>`
</code></pre>
<p>and import it into the component</p>
<pre><code><span class="hljs-keyword">import</span> { html } from '../views/glossop'

export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlossopComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HTMLElement</span> </span>{
    constructor() {
        <span class="hljs-keyword">super</span>();
    }

    connectedCallback() {
        <span class="hljs-keyword">this</span>.innerHTML = <span class="hljs-keyword">this</span>.render();
    }

    render() {
        <span class="hljs-keyword">return</span> html
    }
}
</code></pre>
<p>And it will now be part of our bundle.</p>
<p>Repo at stage 13: <a href="https://github.com/cerico/how-to-js-router/releases/tag/0.13">https://github.com/cerico/how-to-js-router/releases/tag/0.12</a></p>
<h3>8. Production</h3>
<p>Thanks to our original setup, there isn’t actually anything to change from the servers perspective. But we can remove the need to be copying around view files from src to dev as they are now included in the bundle. We could also stretch this to the index.html file but I’ve left as is for now as I think think its somewhat clearer at a glance.</p>
<pre><code>➜  how-<span class="hljs-keyword">to</span>-js-router gi<span class="hljs-variable">t:</span>(master) <span class="hljs-keyword">cat</span> -n package.json
     <span class="hljs-number">1</span>	{
     ...
     <span class="hljs-number">8</span>	    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"webpack-dev-server --config webpack/webpack.config.js --open"</span>,
     <span class="hljs-number">9</span>	    <span class="hljs-string">"build"</span>: <span class="hljs-string">"webpack --config webpack/webpack.prod.config.js &amp;&amp; npm run copy-files"</span>,
    <span class="hljs-number">10</span>	    <span class="hljs-string">"copy-files"</span>: <span class="hljs-string">"cp src/index.html dist"</span>,
    <span class="hljs-number">11</span>	    <span class="hljs-string">"prod"</span>: <span class="hljs-string">"node server.js"</span>
    ...
</code></pre>
</div><div data-reactid="34"><span style="display:inline;" data-reactid="35"><span style="margin-right:8px;line-height:1.5;" data-reactid="36"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#es6" data-reactid="37">ES6</a><span data-reactid="38">,</span></span><span style="margin-right:8px;line-height:1.5;" data-reactid="39"><a style="color:rgb(158, 171, 179);display:inline-block;" href="/tags/#javascript" data-reactid="40">Javascript</a><span data-reactid="41"></span></span></span><hr style="margin-top:1.07rem;" data-reactid="42"/><p style="margin-bottom:0.33rem;" data-reactid="43"><a href="/about/" data-reactid="44"><img src="https://s3.eu-west-2.amazonaws.com/io1937/ghpages/linkedin.jpg" style="float:left;margin-top:0;margin-bottom:0;margin-right:0.4125rem;width:3.3rem;height:3.3rem;border-radius:50%;border:1px gray solid;" data-reactid="45"/></a><span data-reactid="46"><!-- react-text: 47 -->garethrobertlee<!-- /react-text --><a href="/about/" data-reactid="48"></a></span></p><div data-reactid="49"><div data-reactid="50"><span data-reactid="51"><a href="/" data-reactid="52">Posts | </a><a href="/about/" data-reactid="53">About | </a></span><a href="mailto:garethrobertlee@gmail.com?Subject=Hello" target="blank_" data-reactid="54">Contact</a></div></div></div></div></div></div><script src="/bundle.js?t=1504852474977"></script></body></html>